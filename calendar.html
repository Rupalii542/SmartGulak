<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SmartGulak Calendar</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
<style>
body { margin:0; font-family:"Poppins",sans-serif; display:flex; background:#f5f7fa; }
#sidebarContainer { flex-shrink:0; }
.content { flex:1; padding:25px; overflow-x:hidden; }

h1,h2 { color:#1b263b; text-align:center; margin-bottom:20px; }

.card {
  background:#fff;
  border-radius:15px;
  box-shadow:0 8px 20px rgba(0,0,0,0.1);
  padding:20px;
  margin-bottom:25px;
}

/* Add Event Button */
#addEventBtn {
  padding:10px 20px;
  background:#6c63ff;
  color:#fff; border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
  margin-bottom:15px;
  transition:0.3s;
}
#addEventBtn:hover { background:#574fd6; }

/* Modal */
#eventModal {
  display:none;
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.5);
  justify-content:center;
  align-items:center;
  z-index:1000;
}
#eventModal div {
  background:#fff;
  border-radius:12px;
  padding:25px;
  width:90%; max-width:400px;
}
#eventModal input, #eventModal textarea, #eventModal select {
  width:100%; padding:10px;
  margin-bottom:10px; border-radius:8px;
  border:1px solid #ccc; outline:none;
}
#eventModal button {
  padding:10px 15px; border:none; border-radius:8px;
  cursor:pointer; font-weight:600; margin-right:10px;
}
.add-btn { background:#6c63ff; color:#fff; }
.add-btn:hover { background:#574fd6; }
.cancel-btn { background:#ccc; color:#000; }
.cancel-btn:hover { background:#aaa; }

/* Table */
.table-container { max-height:300px; overflow-y:auto; border-radius:12px; }
table { width:100%; border-collapse:collapse; min-width:600px; }
thead { position:sticky; top:0; background:#6c63ff; color:#fff; }
th,td { padding:12px 15px; text-align:left; }
tbody tr { border-bottom:1px solid #eee; }
tbody tr:hover { background:#f1f3f6; }

/* Button Styles */
.btn{padding:5px 10px; border:none; border-radius:5px; cursor:pointer; color:#fff; font-size:12px; transition:0.3s;}
.edit{background:#28a745;} .edit:hover{background:#1e7e34;}
.delete{background:#dc3545;} .delete:hover{background:#a71d2a;}

/* Toast */
.toast{
  position:fixed; bottom:20px; right:20px;
  background:#6c63ff; color:#fff; padding:12px 20px;
  border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,0.3);
  font-weight:600; opacity:0; transition:opacity 0.5s ease; z-index:1001;
}

/* Responsive */
@media(max-width:768px){
  .content{padding:15px;} table{font-size:14px;}
}
</style>
</head>
<body>

<div id="sidebarContainer"></div>

<div class="content">
  <h1>Expense Calendar</h1>
  <div class="card">
    <button id="addEventBtn"><i class="fas fa-plus"></i> Add Event</button>
    <iframe src="https://calendar.google.com/calendar/embed?src=en.indian%23holiday%40group.v.calendar.google.com"
            style="border:0; width:100%; height:400px; border-radius:12px;"
            frameborder="0" scrolling="auto"></iframe>
  </div>

  <h2>My Events</h2>
  <div class="card table-container">
    <table id="eventsTable">
      <thead>
        <tr>
          <th>Date</th>
          <th>Title</th>
          <th>Type</th>
          <th>Note</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<!-- Modal -->
<div id="eventModal">
  <div>
    <h2 id="modalTitle">Add Event</h2>
    <form id="eventForm">
      <label>Date:</label>
      <input type="date" id="eventDate" required>
      <label>Title:</label>
      <input type="text" id="eventTitle" required>
      <label>Type:</label>
      <select id="eventType">
        <option value="Task">Task</option>
        <option value="Reminder">Reminder</option>
        <option value="Event">Event</option>
      </select>
      <label>Note:</label>
      <textarea id="eventNote" placeholder="Optional note"></textarea>
      <div style="display:flex; justify-content:flex-end; margin-top:10px;">
        <button type="submit" class="add-btn">Save</button>
        <button type="button" class="cancel-btn" id="closeModal">Cancel</button>
      </div>
    </form>
  </div>
</div>

<script>
// Load sidebar
fetch('sidebar.html')
  .then(res=>res.text())
  .then(data=>{
    document.getElementById('sidebarContainer').innerHTML=data;
    const usernameElem=document.getElementById('username');
    if(usernameElem) usernameElem.textContent=localStorage.getItem('username')||'User';
    const toggleBtn=document.getElementById('toggleBtn');
    const sidebar=document.getElementById('sidebar');
    if(toggleBtn && sidebar){
      toggleBtn.addEventListener('click',()=>{
        sidebar.classList.toggle('collapsed');
        toggleBtn.querySelector('i').classList.toggle('fa-angle-right');
        toggleBtn.querySelector('i').classList.toggle('fa-angle-left');
      });
    }
  });

document.addEventListener('DOMContentLoaded',()=>{
  const addBtn=document.getElementById('addEventBtn');
  const modal=document.getElementById('eventModal');
  const closeModal=document.getElementById('closeModal');
  const eventForm=document.getElementById('eventForm');
  const tableBody=document.querySelector('#eventsTable tbody');
  const modalTitle=document.getElementById('modalTitle');

  let events=JSON.parse(localStorage.getItem('events'))||[];
  let editIndex=null;

  function renderEvents(){
    tableBody.innerHTML='';
    events.sort((a,b)=>new Date(a.date)-new Date(b.date)).forEach((e,index)=>{
      const row=document.createElement('tr');
      row.innerHTML=`<td>${e.date}</td><td>${e.title}</td><td>${e.type}</td><td>${e.note||'-'}</td>
      <td><button class="btn edit"><i class="fas fa-edit"></i></button>
      <button class="btn delete"><i class="fas fa-trash"></i></button></td>`;
      tableBody.appendChild(row);
      row.querySelector('.delete').onclick=()=>{events.splice(index,1);saveAndRender();showToast('Deleted');};
      row.querySelector('.edit').onclick=()=>openEdit(e,index);
    });
  }

  addBtn.onclick=()=>{modal.style.display='flex'; modalTitle.textContent='Add Event'; eventForm.reset(); editIndex=null;};
  closeModal.onclick=()=>modal.style.display='none';

  function openEdit(ev,idx){
    modal.style.display='flex'; modalTitle.textContent='Edit Event';
    eventForm.eventDate.value=ev.date;
    eventForm.eventTitle.value=ev.title;
    eventForm.eventType.value=ev.type;
    eventForm.eventNote.value=ev.note;
    editIndex=idx;
  }

  eventForm.onsubmit=(e)=>{
    e.preventDefault();
    const data={date:eventForm.eventDate.value,title:eventForm.eventTitle.value,type:eventForm.eventType.value,note:eventForm.eventNote.value};
    if(editIndex!==null){events[editIndex]=data;showToast('Updated');}
    else {events.push(data);showToast('Added');}
    saveAndRender(); modal.style.display='none';
  };

  function saveAndRender(){
    localStorage.setItem('events',JSON.stringify(events));
    renderEvents();
  }

  function showToast(msg){
    const toast=document.createElement('div');
    toast.className='toast';
    toast.textContent=msg;
    document.body.appendChild(toast);
    setTimeout(()=>toast.style.opacity='1',50);
    setTimeout(()=>{toast.style.opacity='0'; setTimeout(()=>toast.remove(),500);},3000);
  }

  renderEvents();
});
</script>
</body>
</html>
